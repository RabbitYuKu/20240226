<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Self Learning Platform</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <!--
      Need a visual blank slate?
      Remove all code in `styles.css`!
    -->
    <link rel="stylesheet" href="todoCSS.css" />
    <script type="module" src="script.js"></script>
  </head>
  <body>
    <div class="menu">
      <input type="image" class="menu-button" onclick="toggleDropdown()" src="https://www.clipartmax.com/png/full/158-1587307_burger-menu-icon-white.png"/>
      <h1 class="menu">To-do List</h1>
      <div class="dropdown" id="myDropdown">
          <a href="/addTodo.html">Add Task</a>
          <a href="/todoList.html">To-do List</a>
          <a href="/timer.html">Timer</a>
      </div>      
      
  </div>

  <div class="overlay" id="myOverlay" onclick="closeDropdown()"></div>
  <div class="separator"></div> <!--分隔線-->

  <div class="tile" id="tilesContainer">
    <!--<div class="tile-item" id="tile" onclick="toggleSubmenu(this)">tile1</div>
    <div class="subtile">
        <div class="subtile-item" id="subtile">
          <p>選項 1</p>
        </div>
        <input type="button" class="subtile-button" value="Start Working"><p></p>
    </div> -->
</div>



  <input type="image" class="addButton" id="addButton" src="/add.png">
  <script>
    const userID = localStorage.getItem("userID")
    const task = []
    copyTile()
    const items = document.querySelectorAll('.subtile-button')
    items.forEach(item => {
      item.addEventListener('click', function() {
        const itemId = this.getAttribute('id');
        localStorage.setItem("task",task[itemId])
        window.location.href= "/timer.html"
    })
    })

    const button = document.getElementById("addButton")
    button.addEventListener("click",function(){
      window.location.href="/addtodo.html"
    })

    function toggleDropdown() { //menu button
        const dropdown = document.getElementById("myDropdown");
        const overlay = document.getElementById("myOverlay");
        dropdown.classList.toggle("show");
        overlay.classList.toggle("show");
    }

    function closeDropdown() {
        const dropdown = document.getElementById("myDropdown");
        const overlay = document.getElementById("myOverlay");
        dropdown.classList.remove("show");
        overlay.classList.remove("show");
    }

    // tile menu
    window.onclick = function(event) {
        if (!event.target.matches('.menu-button')) {
            closeDropdown();
        }
    }

    function toggleSubmenu(menuItem) {
        const submenu = menuItem.nextElementSibling;
        submenu.classList.toggle('open');
        }

    function copyTile() {
      task.push("action=addTodo&userID=123@gmail.com&titleID=task1&descriptionID=1234&dateID=2024-12-19","action=addTodo&userID=123@gmail.com&titleID=task114514&descriptionID=erertetet&dateID=2024-12-04")
      //await fetch('https://script.google.com/macros/s/AKfycbxtlx7G2v3Z9NfFKPD5nylJBkFMrL4q1vuxXqZnikjFizS9_46ePjA52Yq14MZvnqfq/exec'
      //+`?action=${"todoList"}&userID=${userID}`))

      for (let i = 0 ; i < task.length;i ++) {

      const params = new URLSearchParams(task[i]);
      const title = params.get('titleID');
      const description = params.get('descriptionID');
      const tilesContainer = document.getElementById('tilesContainer');

      const tileItem = document.createElement('div');
      tileItem.className = 'tile-item';
      tileItem.onclick = function() { toggleSubmenu(tileItem); };
      tileItem.textContent = title;

      const subtile = document.createElement('div');
      subtile.className = 'subtile';

      const subtileItem = document.createElement('div');
      subtileItem.className = 'subtile-item';
      subtileItem.id = 'subtile';

      const p = document.createElement('p');
      p.textContent = description;

      const startButton = document.createElement('input');
      startButton.type = 'button';
      startButton.id = i;
      startButton.className = 'subtile-button';
      startButton.value = 'Start Working';

      subtileItem.appendChild(p);
      subtile.appendChild(subtileItem);
      subtile.appendChild(startButton);

      tilesContainer.appendChild(tileItem);
      tilesContainer.appendChild(subtile);
      }
      console.log(task[0])
      console.log(userID)
    }


  </script>
    </body>